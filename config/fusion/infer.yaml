# ==============================================================================
# 推理核心配置（控制推理引擎选择、批量处理、结果存储与评估）
# 引入 base 通用键：模型/数据/生成/引擎等
imports:
    - ./core.yaml
# 适用场景：swift infer 命令，支持多种推理后端、批量推理与结果分析
# ==============================================================================

infer_backend: "pt"  # 推理加速后端（选择高效推理引擎）
                     # 可选值：
                     # - "pt"：PyTorch原生推理（兼容性最强）
                     # - "vllm"：vLLM推理引擎（高并发、低延迟）
                     # - "sglang"：SGLang推理引擎（MoE模型优化、推测解码）
                     # - "lmdeploy"：LMDeploy推理引擎（量化优化、多模态部署）
                     # 注意：所有引擎均使用swift的template，由--template_backend控制
                     # 默认值："pt"

max_batch_size: 1  # 批量推理大小（仅infer_backend="pt"时生效）
                   # 取值：-1=无限制，正数=固定批量大小（根据显存调整）
                   # 默认值：1

result_path: null  # 推理结果存储路径（JSONL格式）
                   # 自动逻辑：
                   # - null时，保存在checkpoint目录（含args.json）或"./result"目录
                   # - 最终路径会在命令行打印
                   # 注意：若文件已存在，会追加写入（不覆盖历史结果）
                   # 默认值：null

write_batch_size: 1000  # 结果写入批次大小（控制IO效率）
                        # 取值：-1=无限制（一次性写入），正数=分批次写入
                        # 用途：避免大文件写入时IO阻塞，提升效率
                        # 默认值：1000

metric: null  # 推理结果评估指标（对生成/分类结果进行量化分析）
              # 可选值：
              # - "acc"：准确率评估（适用于分类任务）
              # - "rouge"：ROUGE分数评估（适用于文本生成任务）
              # 默认值：null（不进行评估）

val_dataset_sample: null  # 推理数据集采样数（限制推理样本量）
                          # 用途：快速测试推理效果，避免全量数据集耗时过长
                          # 默认值：null（使用全量数据集）

reranker_use_activation: true  # Reranker推理激活函数开关（对score应用sigmoid）
                               # 适用场景：reranker模型推理（将原始score映射到0~1区间）
                               # 默认值：true