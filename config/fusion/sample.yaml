# ==============================================================================
# 采样核心配置（控制过程奖励模型、结果奖励模型、采样策略与输出管理，适配高质量数据生成场景）
# 引入 base 通用键：模型/数据/生成/引擎等
imports:
    - ./core.yaml
# 适用场景：swift sample 命令，支持PRM/ORM筛选、多引擎采样、分片并行处理
# ==============================================================================

prm_model: null  # 过程奖励模型（PRM）配置
                 # 可选值：
                 # - 模型ID（以PyTorch方式加载，如"modelscope/Llama-2-7b-chat"）
                 # - Plugin中定义的PRM Key（自定义推理逻辑）
                 # 用途：对采样过程进行奖励打分，筛选高质量中间结果
                 # 默认值：null

orm_model: null  # 结果奖励模型（ORM）配置
                 # 说明：通常为Plugin中定义的规则（如通配符匹配、测试用例校验）
                 # 用途：对最终采样结果进行质量评估
                 # 默认值：null

sampler_type: null  # 采样类型（控制采样策略）
                    # 可选值："sample"（随机采样）、"distill"（蒸馏采样）
                    # 默认值：null

sampler_engine: "pt"  # 采样模型推理引擎（控制采样效率）
                      # 可选值："pt"（PyTorch原生）、"lmdeploy"、"vllm"、"client"（远程服务）、"no"（不采样，仅用缓存）
                      # 默认值："pt"

# ==============================================================================
# 输出管理配置（存储路径、文件命名、覆盖策略）
# ==============================================================================

output_dir: "sample_output"  # 采样结果输出目录
                             # 默认值："sample_output"

output_file: null  # 采样结果文件名（仅支持JSONL格式）
                   # 自动逻辑：null时使用时间戳作为文件名，无需传入目录
                   # 默认值：null

override_exist_file: false  # 文件名存在时覆盖开关
                            # 取值：true=覆盖已有文件，false=文件存在时抛出异常
                            # 默认值：false

# ==============================================================================
# 采样参数配置（控制采样规模、批次大小）
# ==============================================================================

num_sampling_batch_size: null  # 单次采样的批处理大小（根据显存调整）
                               # 默认值：null

num_sampling_batches: null  # 总采样批次数量（控制采样数据总量）
                            # 默认值：null

n_best_to_keep: null  # 保留的最佳序列数量（按PRM/ORM分数筛选）
                      # 默认值：null

data_range: null  # 数据集分片处理参数（支持并行采样）
                  # 格式："2 3"（表示数据集分为3份，本实例处理第2份，索引从1开始）
                  # 用途：多进程并行采样，提升效率
                  # 默认值：null

num_return_sequences: 64  # 每次采样返回的原始序列数量（仅对"sample"类型有效）
                          # 用途：提供足够多的候选序列供后续筛选
                          # 默认值：64

# ==============================================================================
# 筛选与过滤配置（控制采样结果质量）
# ==============================================================================

temperature: 1.0  # 采样温度（控制生成多样性，1.0为默认随机度）
                  # 默认值：1.0

prm_threshold: 0.0  # PRM分数阈值（低于该值的结果会被过滤）
                    # 默认值：0.0（不过滤低PRM分数结果）

easy_query_threshold: null  # 简单查询过滤阈值（按ORM正确比例筛选）
                            # 逻辑：单个query的ORM正确比例>该值时，丢弃该query（避免简单数据）
                            # 取值：null=不过滤简单查询，0~1之间的浮点数=比例阈值
                            # 默认值：null

# ==============================================================================
# 引擎额外参数与缓存配置（适配复杂场景与显存优化）
# ==============================================================================

engine_kwargs: null  # 采样引擎额外参数（JSON字符串格式）
                     # 示例：'{"cache_max_entry_count": 0.7, "tensor_parallel_size": 2}'
                     # 用途：传递引擎专属配置（如显存占用比例、并行数）
                     # 默认值：null

cache_files: null  # 缓存文件路径（分两步采样，避免显存OOM）
                   # 使用逻辑：
                   # 1. 第一步：prm=orm=null，sampler_engine=pt，输出所有采样结果到缓存文件
                   # 2. 第二步：sampler_engine=no，传入该缓存文件路径，仅执行PRM/ORM评估
                   # 注意：需保持--dataset参数与第一步一致（通过md5关联数据）
                   # 默认值：null